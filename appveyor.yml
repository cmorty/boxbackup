version: 1.0.{build}
# No need to get the whole history
clone_depth: 1

# https://github.com/cppformat/cppformat/blob/master/support/appveyor-build.py

install:


  - set PATH=C:\MinGW\msys\1.0\bin;C:\MinGW\bin;%PATH%
  - echo %PATH%


  # mingw
  - mingw-get install zlib
  - mingw-get install libz-dev 
  - mingw-get install mingw-zlib-devel

  # Build Openssl
  - cmd: cd %APPVEYOR_BUILD_FOLDER%/..
  - echo %PATH%
  - appveyor DownloadFile "http://www.openssl.org/source/openssl-1.0.2d.tar.gz"
  - tar xf openssl-1.0.2d.tar.gz
  - mv openssl-1.0.2d openssl

  - cmd: cd openssl
  - perl Configure --prefix=/usr/i686-pc-mingw32/ mingw > openssl-configure.log
  - make > openssl-make.log
  - make install_sw 


  # PCRE
  - cmd: cd %APPVEYOR_BUILD_FOLDER%/..
  - echo %PATH%
  - appveyor DownloadFile "http://prdownloads.sourceforge.net/pcre/pcre-8.12.tar.bz2?download"
  - tar xf pcre-8.12.tar.bz2
  - mv pcre-8.12 pcre
  - cmd: cd pcre

  - sh -c './configure --prefix=/usr/i686-pc-mingw32 --disable-shared || cat config.log'  > pcre-configure.log
  - make  > pcre-make.log
  - make install




  # Clean up WD
  - cmd: cd %APPVEYOR_BUILD_FOLDER%
  - echo %CD%


build_script:
  - sh infrastructure/mingw/configure.sh
  - sh make
